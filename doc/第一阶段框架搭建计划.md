# 第一阶段框架搭建计划

## 一、总体目标与时间安排

**目标**：完成基础框架搭建，为后续业务开发提供技术基础  
**时间**：2026/1/30～2026/2/3（5天）  
**交付物**：可运行的微服务框架、基础设施环境、统一规范、API文档与Mock

---

## 二、详细任务分解

### Day 1：工程初始化（2026/1/30）

#### 2.1.1 父工程创建
- [ ] 创建Maven父工程 `pom.xml`
  - 定义Spring Boot版本（2.7.x或3.x）
  - 定义Spring Cloud版本（2021.x或2022.x）
  - 统一管理依赖版本（dependencyManagement）
  - 定义子模块
- [ ] 创建 `.gitignore` 文件
- [ ] 创建 `README.md` 项目说明文档

#### 2.1.2 公共模块创建
- [ ] **common-core** 模块
  - 包结构：`com.sia.common.core`
  - 核心类：
    - 常量类（Constants）
    - 枚举类（Enums）
    - 异常类（Exceptions）
    - 工具类（Utils）
    - ID生成器（SnowflakeIdGenerator）
- [ ] **common-security** 模块
  - 包结构：`com.sia.common.security`
  - 核心类：
    - JWT工具类（JwtUtil）
    - 密码加密工具（PasswordEncoder）
    - 安全配置类（SecurityConfig）
- [ ] **common-web** 模块
  - 包结构：`com.sia.common.web`
  - 核心类：
    - 统一响应类（Result<T>）
    - 全局异常处理器（GlobalExceptionHandler）
    - 统一拦截器（Interceptor）
    - 参数验证（Validation）
- [ ] **common-dbservice** 模块
  - 包结构：`com.sia.common.dbservice`
  - 核心类：
    - MyBatis配置类（MyBatisConfig）
    - 数据源配置类（DataSourceConfig）
    - BaseMapper基类（BaseMapper<T>）
    - 类型处理器（LocalDateTimeTypeHandler、JsonTypeHandler）
    - MyBatis拦截器（PageInterceptor、SqlLogInterceptor）

#### 2.1.3 依赖配置
- [ ] 配置各模块依赖关系
- [ ] 引入核心依赖：
  - Spring Boot Starter
  - Spring Cloud Gateway
  - MyBatis-Plus
  - Redis
  - RabbitMQ
  - Hutool、Lombok、MapStruct
  - JWT相关依赖

**交付物**：
- ✅ Maven父工程及子模块结构
- ✅ 公共模块基础代码框架
- ✅ 依赖配置完成

---

### Day 2：基础设施搭建（2026/1/31）

#### 2.2.1 MySQL数据库
- [ ] 创建数据库schema
- [ ] 创建核心表结构（SQL脚本）：
  - 用户表（user）
  - 问题表（question）
  - 回答表（answer）
  - 评论表（comment）
  - 其他核心业务表
- [ ] 创建数据库初始化脚本（`sql/init.sql`）

#### 2.2.2 Redis集成
- [ ] Redis配置类
- [ ] Redis工具类（RedisUtil）
- [ ] 连接池配置
- [ ] 测试Redis连接

#### 2.2.3 RabbitMQ集成
- [ ] RabbitMQ配置类
- [ ] 定义Exchange、Queue、Binding
- [ ] 消息发送工具类（MessageSender）
- [ ] 测试消息发送接收

#### 2.2.4 Docker Compose环境
- [ ] 创建 `docker-compose.yml`
- [ ] 配置MySQL容器
- [ ] 配置Redis容器
- [ ] 配置RabbitMQ容器
- [ ] 验证本地环境启动

**交付物**：
- ✅ MySQL数据库及核心表结构
- ✅ Redis集成完成
- ✅ RabbitMQ集成完成
- ✅ Docker Compose本地环境可运行

---

### Day 3：网关搭建（2026/2/1）

#### 2.3.1 API Gateway模块
- [ ] 创建 `api-gateway` 模块
- [ ] 创建 `GatewayApplication` 启动类
- [ ] 配置 `pom.xml` 依赖

#### 2.3.2 路由配置
- [ ] 配置基础路由规则
- [ ] 配置服务路由：
  - `/api/user/**` → user-service
  - `/api/content/**` → content-service
  - `/api/activity/**` → activity-service
  - 其他业务服务路由

#### 2.3.3 统一鉴权
- [ ] JWT认证过滤器（JwtAuthFilter）
- [ ] Token验证逻辑
- [ ] 白名单配置（登录、注册等接口）
- [ ] 用户信息传递（通过Header或Context）

#### 2.3.4 跨域配置
- [ ] CORS配置
- [ ] 允许的域名、方法、Header配置

#### 2.3.5 限流与熔断
- [ ] 集成限流策略（Redis限流）
- [ ] 集成熔断策略（Resilience4j或Sentinel）
- [ ] 配置限流规则
- [ ] 配置熔断规则

**交付物**：
- ✅ API Gateway可启动
- ✅ 路由配置完成
- ✅ JWT鉴权功能可用
- ✅ 跨域配置完成
- ✅ 限流熔断策略注册完成

---

### Day 4：统一规范（2026/2/2，0.5天）

#### 2.4.1 统一响应格式
- [ ] 定义 `Result<T>` 统一响应类
  - code：状态码
  - message：消息
  - data：数据
  - timestamp：时间戳
- [ ] 定义响应状态码枚举（ResultCodeEnum）

#### 2.4.2 错误码规范
- [ ] 定义错误码枚举
- [ ] 错误码文档

#### 2.4.3 日志规范
- [ ] Logback配置文件
- [ ] 日志级别配置
- [ ] 日志格式规范
- [ ] 日志输出位置配置

#### 2.4.4 异常处理
- [ ] 全局异常处理器（GlobalExceptionHandler）
- [ ] 自定义异常类
- [ ] 异常统一响应格式

**交付物**：
- ✅ 统一响应格式实现
- ✅ 错误码规范文档
- ✅ 日志配置完成
- ✅ 全局异常处理完成

---

### Day 5：接口文档与Mock（2026/2/3，0.5天）

#### 2.5.1 Apifox项目创建
- [ ] 在Apifox创建项目
- [ ] 配置项目基本信息
- [ ] 配置环境（开发、测试、生产）

#### 2.5.2 统一响应格式配置
- [ ] 在Apifox中定义统一响应格式
- [ ] 配置Mock规则

#### 2.5.3 用户/认证接口文档
- [ ] 用户注册接口
  - 请求参数：用户名、密码、邮箱等
  - 响应参数：用户信息、Token
- [ ] 用户登录接口
  - 请求参数：用户名/邮箱、密码
  - 响应参数：Token、用户信息
- [ ] Token刷新接口
- [ ] 用户退出接口
- [ ] 用户信息查询接口
- [ ] 用户信息更新接口

#### 2.5.4 Mock数据配置
- [ ] 为各接口配置Mock数据
- [ ] 验证Mock数据返回

#### 2.5.5 接口联调测试
- [ ] 验证认证接口可调通
- [ ] 验证Token生成与验证
- [ ] 验证接口响应格式

**交付物**：
- ✅ Apifox项目创建完成
- ✅ 用户/认证接口文档完成
- ✅ Mock数据配置完成
- ✅ 认证接口可调通

---

## 三、技术栈版本

| 技术 | 版本 | 说明 |
|------|------|------|
| Spring Boot | 3.2.5 | 核心框架 |
| Spring Cloud | 2023.0.1 | 微服务框架 |
| Java | 21 | JDK版本 |
| Spring Cloud Gateway | 4.0.9 | API网关 |
| Spring Cloud OpenFeign | 4.0.9 | 服务调用 |
| Spring Cloud Config | 4.0.9 | 配置中心 |
| Micrometer Tracing | 1.2.3 | 链路追踪（替代Spring Cloud Sleuth） |
| MySQL | 8.0.35 | 数据库 |
| Redis | 7.2.4 | 缓存 |
| RabbitMQ | 3.12.10 | 消息队列 |
| MyBatis-Plus | 3.5.5 | ORM框架 |
| HikariCP | 5.1.0 | 数据库连接池 |
| Hutool | 5.8.25 | 工具类库 |
| Lombok | 1.18.30 | 代码简化 |
| MapStruct | 1.5.5.Final | 对象映射 |
| JJWT | 0.12.5 | JWT Token认证 |
| Spring Security | 6.2.3 | 安全框架 |
| BCrypt | 0.10.2 | 密码加密（Spring Security内置） |

---

## 四、项目结构

```
problem-to-hero-backend/
├── doc/                          # 文档目录
│   ├── 开发方案.md
│   ├── 功能需求优先级.md
│   ├── 第一阶段框架搭建计划.md
│   └── ...
├── common/                       # 公共模块
│   ├── common-core/              # 核心公共模块
│   ├── common-security/          # 安全公共模块
│   ├── common-web/               # Web公共模块
│   └── common-dbservice/         # 数据库服务模块（DAO层公共模块）
├── gateway/                      # API网关
│   └── api-gateway/
├── services/                     # 业务服务（后续创建）
│   ├── user-service/
│   ├── content-service/
│   └── ...
├── sql/                          # SQL脚本
│   └── init.sql
├── docker-compose.yml            # Docker Compose配置
├── pom.xml                       # 父POM
└── README.md                     # 项目说明
```

---

## 五、交付物检查清单

### Day 1 检查清单
- [ ] 父工程创建完成，可正常构建
- [ ] 公共模块创建完成，包结构正确
- [ ] 依赖配置完成，无冲突
- [ ] 代码可编译通过

### Day 2 检查清单
- [ ] MySQL数据库创建完成
- [ ] 核心表结构创建完成
- [ ] Redis连接测试通过
- [ ] RabbitMQ连接测试通过
- [ ] Docker Compose环境可启动

### Day 3 检查清单
- [ ] API Gateway可启动
- [ ] 路由配置正确，可转发请求
- [ ] JWT鉴权功能可用
- [ ] 跨域配置正确
- [ ] 限流熔断策略注册完成

### Day 4 检查清单
- [ ] 统一响应格式实现完成
- [ ] 错误码规范文档完成
- [ ] 日志配置完成，日志可正常输出
- [ ] 全局异常处理完成，异常可统一响应

### Day 5 检查清单
- [ ] Apifox项目创建完成
- [ ] 用户/认证接口文档完成
- [ ] Mock数据配置完成
- [ ] 认证接口可调通，返回格式正确

---

## 六、风险与注意事项

### 6.1 技术风险
- **JDK版本兼容性**：确保Spring Boot版本与JDK版本兼容
- **Spring Cloud版本兼容性**：确保Spring Boot与Spring Cloud版本匹配
- **中间件版本**：确保Redis、RabbitMQ版本与Spring Boot兼容

### 6.2 配置风险
- **环境变量**：注意不同环境的配置差异
- **配置文件**：使用Spring Profile管理不同环境配置
- **端口冲突**：注意各服务端口配置，避免冲突

### 6.3 协作风险
- **API规范**：确保前后端API规范一致
- **代码规范**：遵循统一的代码规范
- **Git规范**：遵循Git工作流规范

---

## 七、后续工作

完成第一阶段框架搭建后，将进入第二阶段开发：
- **Week 2**：用户服务与认证（2026/2/4～2026/2/8）
- **Week 3**：问答社区（2026/2/9～2026/2/14）
- 其他业务功能开发...

---

*本文档基于《开发方案.md》和《功能需求优先级.md》制定，实施过程中可根据实际情况调整。*
